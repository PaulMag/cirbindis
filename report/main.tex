\documentclass[a4paper, 12pt, english, titlepage]{article}

% Import packages:
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{graphicx, color}
\usepackage{parskip} % norwegian sections (skip line)
\usepackage{amsmath}
\usepackage{varioref} % fancy captions
\usepackage[margin=3cm]{geometry} % smaller margins
\usepackage{grffile} % ex­tended file name sup­port for graph­ics, allows periods in filenames
\usepackage{hyperref} % allows hyperlinks with the \href command


% Set code style:
\definecolor{darkgreen}{RGB}{0,135,0}
\usepackage{listings}
% \lstset{language=python}
\lstset{basicstyle=\ttfamily\scriptsize} % \small if short code
\lstset{frame=single} % creates the frame around code
% \lstset{title=\lstname} % display name of file, not necessary
\lstset{keywordstyle=\color{red}\bfseries}
\lstset{commentstyle=\color{blue}}
\lstset{stringstyle =\color{darkgreen}}
\lstset{showspaces=false}
\lstset{showstringspaces=false}
\lstset{showtabs=false}
\lstset{breaklines=true}
\lstset{tabsize=4}

% Custom commands:
%\newcommand{\nameOfCommand}[numberOfArguments]{command}
\newcommand{\D}[1]{\ \mathrm{d}#1} % steps in integrals, ex: 4x \D{x} -> 4x dx
\newcommand{\E}[1]{\cdot 10^{#1}}  % exponents, ex: 1.4\E{3} -> 1.4*10^3
\newcommand{\U}[1]{\, \textrm{#1}} % display units prettily, ex: 15.4\U{m} -> 15.4 m
\newcommand{\degree}{\, ^\circ}    % make a degree symbol
\newcommand{\sname}{\texttt{CirBinDis }}

\newcommand{\bilde}[3]{
    \begin{figure}[htbp]
        \centering
        \includegraphics[width=\textwidth]{#1}
        \caption{#3 \label{#2}}
    \end{figure}
}
\newcommand{\bildeto}[4]{
    \begin{figure}[htbp]
        \centering
        \includegraphics[width=0.96\textwidth]{#1}
        \includegraphics[width=0.96\textwidth]{#2}
        \caption{#4 \label{#3}}
    \end{figure}
}

% Opening:
\title{\sname \\ Circumbinary disk analyser}
\author{Paul Magnus Sørensen-Clark \\ Jerome Bouvier}

% Begin document:
\begin{document}

\maketitle
\tableofcontents

\vfill
Contact:

Paul Magnus Sørensen-Clark:
\href{mailto:paulmag91@gmail.com}{paulmag91@gmail.com}

Jerome Bouvier:
\href{mailto:jerome.bouvier@obs.ujf-grenoble.fr}{jerome.bouvier@obs.ujf-grenoble.fr}

\url{https://bitbucket.org/paulmag/circumbinarydisk}

\clearpage


%===============================================================================
\section{Introduction}
%-------------------------------------------------------------------------------

A small piece of software for receiving an artificial light curve from a simulated density map of a gas disk around a binary star.


%===============================================================================
\section{Installing}
%-------------------------------------------------------------------------------

The source code is available at this Bitbucket repository: \\
\url{https://bitbucket.org/paulmag/circumbinarydisk} \\
Provided that Git is installed on you computer you can easily get all the files by running the following command inside the folder where you want the repository: \\
\texttt{git clone https://paulmag@bitbucket.org/paulmag/circumbinarydisk.git} \\
This link will be updated if the location of the repository or the installation process in any other way changes (note that at this moment the repository is private).
Should it not work then contact the authors via email.

We recommended to make the alias \texttt{cirbindis} for the command \\
\texttt{python \textasciitilde/path\_to\_repository\_folder/circumbinarydisk/src/main.py}. \\
F. ex. place this in your \texttt{.bashrc} or \texttt{.bash\_aliases}:
\begin{verbatim}
    alias cirbindis="python ~/GitHub/circumbinarydisk/src/main.py"
\end{verbatim}
This alias will be assumed for the rest of this manual.


%===============================================================================
\section{Preparing your data}
%-------------------------------------------------------------------------------

The format of the input data must be an ASCII/CSV-file with three columns where each line represents a datapoint in space. The two first columns of each line represent the position of a datapoint. $(x, y)$ if using cartesian coordinates and $(r, \theta)$ if using polar coordinates. The last column represents the density in this position.

Any units can be used for the input data. How to specify units are covered in the section \textbf{Configuring and running \sname}.

(It is currently possible to have four instead of three. Then the three first columns represent $(x, y, z)$ or $(r, \theta, z)$. The use of 3D-datapoints is currently an obsolete feature that will probably be completely removed.)


%===============================================================================
\section{Processing algorithm}
%-------------------------------------------------------------------------------

\sname produces artificial lightcurves by analysing the provided dataset according to given configurations. In this section the process for extracting the lightcurve from the dataset is explained.

\subsection{Loading data}
    %TODO
    \textbf{TODO}

\subsection{Cropping}
    The space covered by the dataset may represent a larger area than the disk you want to analyse. The dataset is cropped to an inner and outer radius such that the shape of the remaining datapoints resembles a donut. The outer radius represents the size of the disk and makes sure that the disk is circular. The inner radius is necessary to avoid treating the stars themselves as dust, and the density of the dust is very low close to the stars anyway.

\subsection{Rotating}
    The coordinates of all datapoints are rotated stepwise with the rotation
    matrix $R_z$ for $\theta = [0, 360)\degree$.
    $$
    R_z =
    \begin{bmatrix}
        \cos(\theta) & -\sin(\theta) &              0 \\
        \sin(\theta) &  \cos(\theta) &              0 \\
                   0 &             0 &              1 \\
    \end{bmatrix}
    $$
    This rotation simulates the physical orbital rotation of the dircumbinary
    disk. The reason we get a variation in the lightcurve is because when the
    disk rotates we see the stars through different areas of the disk with
    different densities.

\subsection{Sylinder}
    A section of the datapoints are cropped out, which represents only the sylinder of gas that is between an observer on Earth and the star. These are the datapoints that fall within the sylinder whose base area is defined by the stellar surface and which extends from the stellar surface and infinitely along the $x$-axis in positive direction (the de facto limit is the outer radius of the disk). In other words, the observer's position is assumed to be $(\infty, 0, 0)$. A sylinder like this is made once for \emph{each} azimuthal rotation of all the points. Thus, each sylinder will be a little different from the previous one (if $\D\theta$ is small). If there are two (or even more) stars a sylinder will be created for the line of sight of each star, so there can be two (or even more) sylinders at the same time.

\subsection{Binning}
    %TODO
    \textbf{TODO}

\subsection{Integrating}
    %TODO
    \textbf{TODO}


%===============================================================================
\section{Configuring and running \sname}
%-------------------------------------------------------------------------------

How to make necessary configurations and then run \sname to perform an analysis.

This is the most practical and maybe the most important section, as it explains how to actually use the software.

\subsection{Input parameters}
    The input parameters for each run of \sname is configured in an XML file. Inside the repository you will find \texttt{/xml/input.xml}. Copy this file to the path where you will run \sname from and change the value of the fields as required (it must still be called \texttt{input.xml}). Specifically, this is where you provide the filename of the dataset to analyse.

    %TODO
    \textbf{TODO}: Here I plan to more or less copy the explanations that are in \texttt{input.xml} already.

    \begin{description}
        \item[unit-mass] Dorem
        \item[unit-distance] ipsum
        \item[unit-intensity] dolum
    \end{description}

\subsection{Executing the code}
    %TODO
    \textbf{TODO}

%===============================================================================
\section{Bibliography}
%-------------------------------------------------------------------------------


%===============================================================================
\section{Acknowledgments}
%-------------------------------------------------------------------------------


%===============================================================================
\section{Source code}
%-------------------------------------------------------------------------------

\subsection{\texttt{input.xml}}
    \lstinputlisting[language=XML]{../xml/input.xml}

\subsection{\texttt{main.py}}
    \lstinputlisting[language=Python]{../src/main.py}

\subsection{\texttt{DensityMap.py}}
    \lstinputlisting[language=Python]{../src/DensityMap.py}

\subsection{\texttt{Star.py}}
    \lstinputlisting[language=Python]{../src/Star.py}

\subsection{\texttt{Functions.py}}
    \lstinputlisting[language=Python]{../src/Functions.py}

\subsection{\texttt{plot.py}}
    \lstinputlisting[language=Python]{../src/plot.py}

\subsection{\texttt{make\_testdata.py}}
    \lstinputlisting[language=Python]{../src/make_testdata.py}


\end{document}
